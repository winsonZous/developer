## Mysql

- Mysql是DBMS的主流产品

- 工具 Mysql 8.0，DBeaver

- sql是操作数据库的命令，如同汽车的方向盘，指示灯，油门，刹车一样。 企业业务数据都是存放在数据库里面，我们得很熟悉命令才能操纵数据库里面的数据。

## 结构化查询语言SQL

## 一、基础语句

### DQL（数据查询）

- 查询行记录

```sql
SELECT * FROM table_name 
WHERE condition
JOIN table_name 
ON condition
GROUP BY column
HAVING condition
ORDER BY column
LIMIT offset; 
```

### DML（数据操纵）

### 插入语句

- 插入单行记录

```sql
INSERT INTO table_name (column_name,column_name,...) values(value,value,...);
```

- 插入多行记录

```sql
INSERT INTO table_name 
(column_name,column_name,...) 
values
(value,value,...),
(value,value,...),
(value,value,...),
(value,value,...),
(value,value,...),
(value,value,...);
```

### 删除语句

- 删除单行记录

```sql
DELETE FROM table_name WHERE condition;
```

### 更新语句

```sql
UPDATE table_name SET column=value,column=value,...;
```

### DDL（数据定义）

- 创建模式/数据库

```sql
mysql中schema=database
create database knowledge;
create schema knowledge ;
```

- 查看数据库

```sql
show databases;
```

- 创建表结构

```sql
CREATE TABLE `user` (
  `name` varchar(32) NOT NULL,
  `id` varchar(32) DEFAULT NULL,
  `curTime` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

- 修改表结构

```sql

```

- 删除表结构

```sql
TRUNCATE TABLE table_name;
```

```sql
DROP TABLE table_name;
```

- 查看表结构
```sql
desc  table_name;
```sql
查看建表语句
SHOW CREATE TABLE table_name;
```
```sql
查看建表语句
SHOW CREATE TABLE table_name;
```
### DCL（数据控制）

- GRANT
- REVOKE

### 事务

- 开启事务语句

 ```sql
BEGIN;
```

- 提交事务语句

```sql
COMMIT;
```

- 回滚事务语句

 ```sql
ROLLBACK;
```

- 设置全局事务

 ```sql
SET AUTOCOMMIT=0 禁止自动提交
SET AUTOCOMMIT=1 开启自动提交
```

- 回滚事务案例

```sql
DROP TABLE `user`;

CREATE TABLE `user` (
  `name` varchar(32) NOT NULL,
  `id` varchar(32) DEFAULT NULL,
  `curTime` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `user`
(name, id, curTime)
VALUES('tom', '20210721', '2021-07-01 00:00:00');

BEGIN;
UPDATE `user`
SET id='20210722', curTime='2021-07-01 00:00:00'
WHERE name='tom';
COMMIT;

SELECT * FROM `user`;
预期结果提交事务成功，id值被成功修改。
```

```
create database market;
use market;
CREATE TABLE `orders` (
`id` varchar(128) NOT NULL,
`value` varchar(128) DEFAULT NULL,
`orderDate` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`totalMoney` varchar(128) DEFAULT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO market.orders
(id, value, orderDate, totalMoney)
VALUES('123456', '123456', CURRENT_TIMESTAMP, '100');


SELECT id, value, orderDate, totalMoney FROM market.orders;
start transaction;
delete  from market.orders ;
SELECT id, value, orderDate, totalMoney FROM market.orders;
commit;
rollback;
SELECT id, value, orderDate, totalMoney FROM market.orders;
```

## 保留点
回退到保留点

```
create database market;
use market;
CREATE TABLE `orders` (
`id` varchar(128) NOT NULL,
`value` varchar(128) DEFAULT NULL,
`orderDate` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
`totalMoney` varchar(128) DEFAULT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO market.orders
(id, value, orderDate, totalMoney)
VALUES('123456', '123456', CURRENT_TIMESTAMP, '100');

start transaction;
INSERT INTO market.orders
(id, value, orderDate, totalMoney)
VALUES('1234567', '123123', CURRENT_TIMESTAMP, '100');

savepoint beforeDelete;
delete  from market.orders ;
SELECT id, value, orderDate, totalMoney FROM market.orders;

INSERT INTO market.orders
(id, value, orderDate, totalMoney)
VALUES('12345678', '123123', CURRENT_TIMESTAMP, '100');

SELECT id, value, orderDate, totalMoney FROM market.orders;

rollback to beforeDelete;

SELECT id, value, orderDate, totalMoney FROM market.orders;
commit;
rollback;
```

## 二、常用函数

- SUM
- COUNT
- SUB
- CONCAT
-

## SQL优化
### 等价SQL

### 索引
- B+ Tree 索引
- Hash 索引
- 索引的最左匹配原则
`
严禁左模糊和全模糊，如果有具体的业务需要，可以通过搜索引擎实现。  
`
## 主从复制与读写分离
- binlog

## DRDS

### 分库分表

#### 分表

- 横向切分
  `
  把表按照业务唯一键切分为多个表 可能会带来的问题？第一个是主键不唯一，第二个是表链接实现。  
  `
- 纵向切分
  ``

#### 分库




## 字典-名词解释

- table_name 表名
- condition 布尔表达式
- column 属性
- column_name 属性名
- value 属性值
- offset 偏移值

## SQL 语法规范


## 参考材料

- 《Mysql高性能》
- 《Java开发手册》